# ML Lab Webapp

The ML Lab Webapp gives access to a variety of information and tools needed for an efficient process with regards to data science and software engineering. It allows you to create a project, upload datasets, see experiment results, get trained models, and deploy them to production with a single click.

## Usage

To use the ML Lab, please refer to [this guide](../README.md#usage).

## Develop

### ML Lab Client Generated by Swagger Editor (https://editor.swagger.io/)

1. Copy swagger.json from backend (`ml-lab ▸ ⁨backend⁩ ▸ lab-service⁩ ▸ ⁨src⁩ ▸ ⁨main⁩ ▸ ⁨resources⁩ ▸ ⁨swagger ▸ swagger.json`) into the Swagger Editor (https://editor.swagger.io/)
2. In Swagger Editor, click Generate Client > JavaScript
3. Unzip javascript client > copy files in `src` to `ml-lab ▸ ⁨webapp⁩ ▸ ⁨src⁩ ▸ ⁨services⁩`
4. Rename generated `index.js` to `lab-api.js`.

### Build

Execute this command in the project root folder to build this project (only needed if npm packages are needed. For code changes, python.run is sufficient as react makes on-the-fly builds):

```bash
python build.py
```

This script compiles the project and builds the static version of the wepapp. For additional script options:

```bash
python build.py --help
```

### Run

Execute this command in the project root folder to start a local :

```bash
python run.py
```

__Local Testing with Remote Endpoint__  
The webapp will use the endpoint relative to the current host. Hence, if the ML Lab is accessed via http://localhost:8090, it calls the endpoint via http://localhost:8090/api. If it is accessed via http://10.20.30.40:30000, the endpoint http://10.20.30.40:30000/api is used.  
If you want to use an ML Lab endpoint different to the webapp host, pass the endpoint url as the _--endpoint_ parameter to the run.py, like `python run.py --endpoint http://40.50.60.70:8050`

For additional script options:

```bash
python run.py --help
```

Visit http://localhost:8090/app to access the webapp.

### Deploy

To use the ML Lab, please refer to [this guide](../README.md#deploy).

## Dev Walkthrough

Last Edited: April 27 2018, 16:19 +0000
Project: ML Lab
Tags: Technical Note

This guide should you lead though the most important parts of the ML Lab interface. We will cover same basic example so that you understand the relations between the different parts.

### Architecture

This section should you give an overview of the main architecture (folder design) of the ML Lab:

- > build

  React apps have the advantage that you can develop and test them pretty fast, but also deploy them in a optimised version. Therefore, the build folder is the bucket to store the optimised part. (not important for development)

- node_modules

  This Folder includes all necessary third-party libraries to run the app. (please do not change something in here manually)

- > public

  This Folder includes the basic files of the application for example the html file and favicons.

  - `index.html`
- src

  This folder contains the visualisation and it's functional part of the ML Lab. 

  - components

    Small fragments of code (e.g. table) of the application that are used in several parts.

  - css

    You can specify your own style for parts that appear in several places inside the application.

  - scenes

    Scenes are the pages of our application (e.g. Dashboard, Datasets,...). 

    - `<scence>.js`
    - components

      Fragments that are only used in one scene, but where excluded from the main .js-file  due to simplification.

  - services
    - client

      Contains the files to communicate with the backend (e.g getProjects, DeleteFile, ...)

      - `ml-lab-api.js`
    - handler

      These files deal with the communication between the components (reduxUtils), their formation (parser) and constant parameters (constants, e.g. widget appearance)

      - `constants.js`
      - `parser.js`
      - `reduxUtils.js`
  - `index.js`

### Quick Start of the Application

After the application is running on the server you can access the interface under the following endpoint:

> <endpoint>:<port>/app

![](https://www.notion.so/file/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0d6face0-1730-4d0f-a138-46bccaa65e41%2FArchitecture.png)

- Index

  The server will first execute the `index.html` and `index.js` files. The `index.js` takes care of

  - Initialising the ReduxStore
  - Register ServiceWorker
  - Initialise the HashRouter
  - Use the CookieStore
  - Render the App Component
- App

  The `App.js` is the central instance in the application. It renders the wrappers for all following scenes (pages).

  - Toolbar
    - Drawer with Navigation Links
    - Create new Project Button
    - Project Selector
  - Content Container
    - Router to all possible scenes

          <Switch>
                      <Route path="/" exact component={Dashboard}/>
                      <Route path="/datasets" exact component={Datasets}/>
          						/*...*/
          </Switch>

### Scenes

The call the different pages of our application **scenes**. They are saved in the scenes folder with the following structure:

- Dashboard
- Datasets
- Workspace
- Experiments
- Models
- Services
- Jobs
- Administration (Portainer)

### Exchange Environment

#### Redux

Redux is an event-based parameter exchange tool, which allows information sharing though the entire architecture. The ML Lab shares the status of the current project though out the application. If the project was changed other components can react on this change, for example by loading the datasets for the new project.

- Connect to ReduxStore

  To be part of the redux network you just have to add the following line in the end of your component.

      export default connect(ReduxUtils.mapStateToProps)(<component_name>)
      //recieve the changes
      
      export default connect(ReduxUtils.mapStateToProps), ReduxUtils.mapDispatchToProps (<component_name>)
      //receive and send changes

  Fill the function `componentWillReceiveProps(nextProps)` with your desired reaction on the receiving information.

- Possible Statements and Access

      //Possible Statements
      onInpChange({target:{value: <project>}})
      
      onCreateProject(<project>)
      
      onNoProjectAvailable(<project>)
      
      onProjectDelet(<project>)

      //Access Statements
      this.props.<statement>

- FlowDiagram: Project Selection

  ![](https://www.notion.so/file/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F60dcb777-60bc-47d5-9374-9b1a5de4c4d1%2FChangeProject.png)

  This Flow Diagram shows the process of determine the current project of ML Lab. After the user entered the application though the entry point the `ProjectSelector.js` is calling though the `ml-lab-api.js` the server for all existing projects (for simplification I will leave the possibility of no existing projects away).

  Afterwards, the component is accessing the cookies of the ML Lab to find out if the ML Lab saved a project in the session.

  - Yes

    Use the cookie project for the current project.

  - No

    Use the first project in the list of the returned projects from the server.

  The ProjectSelector is calling `this.props.onInpChange({target: {value: <project_name>}}` to exchange the information of the new current project. This call will execute all components that are connected to the ReduxStore (see Connect to ReduxStore). They can individually handle their reaction (for example Dashboard: Change the highlighting for the current project). 

  The same procedure will happen if the user is changing the current project except that the project will be saved in the cookies.

  ![](https://www.notion.so/file/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F47fadc4b-3b83-4272-bd25-bbf4313b9ea5%2FReduxStore.png)

#### Cookies

The ML Lab is using **react-cookie** to save information of the application over the session. With the following code lines cookies are activated in your component:

    import { withCookies, Cookies } from 'react-cookie';
    
    //...
    
    //Get parameter of cookie
    cookies.get(<parameter_name>, Constants.COOKIES.options);
    
    //Set parameter of cookie
    cookies.set(<parameter_name>,<new_value>,Constants.COOKIES.options);
    
    //...
    
    //Use Cookies and Redux together
    export default withCookies(connect(ReduxUtils.mapStateToProps, ReduxUtils.mapDispatchToProps)(<Component>));
    
    //Just Cookies
    export default withCookies(<Component>);
